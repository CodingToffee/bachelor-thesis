Node-RED is used as a service for retrieving the data that is published by the PLC's OPC UA server. It further enables the preprocessing and injection into the database. To retrieve the data from the OPC UA server, an OPC UA library called node-red-contrib-opcua is being used. The node with the name timestamp at the beginning of the flow is simply being used to activate the flow. It can be set to various intervals or fixed times. It was decided to set it to an interval of 0.2 seconds. This interval was selected due to the fact that some operations on the sewing machine have an execution time of about 1 second when unexperienced workers operate it. Due to the lack of experienced workers it was estimated that an experienced worker coud be four times as fast. To be sure to capture every event, the interval was set to 0.2 seconds which equals a workers execution time who is five times as fast. The interval could later still be adjusted according to test results. The four subsequent nodes called OPC UA Items each hold the namespace and ID of the different signals. These are fed into the simulator node. This node is configured with the endpoint which consists of the IP adress of the PLC, the port and the name of the OPC UA server if existent. This node outputs the value for each of the OPC UA items in a serial manner. 
The succeding node is one of three function nodes, which hold javascript code to execute three distinct preprocessing steps. Of which the first is to concatenate the four values into one string. The most import reason for concatenating the values is that in influxdb, every value has its own table. If a query would be performed over multiple values, the tables would be needed to be joined which is very compute intense. This can lead to noticeable delays in the final dashboard. By concatenating the values, there is no need for joining the tables anymore because all values are then stored in one table.
An additional advantage of this preprocessing step is that it makes the next step more simple to execute. The next preprocessing step happening in the function node with the name update_statechange is to check whether the concatenated string changes. When the string changes it indicates a state change of the sewing machine and the changes string is then given as an output. By first concatenating the values only one string needs to be compared instead of four. This preprocessing step was implemented to reduce the amount of data that gets stored in the database. Earlier this step was skipped and it appeared to slow down the querying significantly compared to the later result. The output of this second preprocessing node are the four seperate key value value pairs of the signals as well as these in a concatenated string manner. These values are only given as output when the one of the values changes compared to the last state. One of the routs the ouput of this node takes is  as input for the third preprocessing node.
Earlier in the part 4.0.7 the production pattern was descriped that could be used to measure the duration that the machine is actively in use for value adding tasks. The last preprocessing node called "detect_production_pattern" checks whether this pattern is present or not. Its output is the key "pattern" with the value true, indicating the beginning of the pattern or false, indicating the end of the pattern. Also the timestamp of end or beginning of the pattern is part of the output. 
At the end of the flow both the outputs of "update statechange" and of "detect_production_pattern" are  given to the InfluxDB node as input. This node is configured with the address and the API key of the Influx database. It is an Influxdb out node which means that it can only write to InfluxDB. At every write operation it automatically adds a timestamp to the input. Still a timestamp needs to be added at the "detect_production_pattern" node because the pattern can only be detected in retrospective and therefore the timestamp of the InfluxDB node would be too late. 